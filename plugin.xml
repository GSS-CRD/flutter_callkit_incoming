<?xml version='1.0' encoding='utf-8'?>
<plugin id="flutter-callkit-incoming" version="1.0.0" xmlns="http://apache.org/cordova/ns/plugins/1.0" xmlns:android="http://schemas.android.com/apk/res/android">
    <name>Flutter Callkit Incoming for Cordova</name>

    <engines>
        <engine name="cordova" version=">=12.0.0"/>
        <engine name="cordova-android" version=">=12.0.0" />
        <engine name="cordova-ios" version=">=7.0.0" />
    </engines>

    <js-module name="FlutterCallkitIncoming" src="cordova/www/FlutterCallkitIncoming.js">
        <clobbers target="cordova.plugins.FlutterCallkitIncoming" />
    </js-module>

    <platform name="android">
        <config-file parent="/*" target="res/xml/config.xml">
            <feature name="CordovaCallkitIncomingPlugin">
                <param name="android-package" value="com.hiennv.flutter_callkit_incoming.CordovaCallkitIncomingPlugin" />
                <param name="onload" value="true" />
            </feature>
        </config-file>

        <config-file parent="/*" target="AndroidManifest.xml">
            <uses-permission android:name="android.permission.USE_FULL_SCREEN_INTENT"/>
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.VIBRATE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />
            <uses-permission android:name="android.permission.ACCESS_NOTIFICATION_POLICY" />
            <uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
        </config-file>

        <config-file parent="/manifest/application" target="AndroidManifest.xml">
            <activity
                android:name="com.hiennv.flutter_callkit_incoming.CallkitIncomingActivity"
                android:taskAffinity="com.hiennv.flutter_callkit_incoming.INCOMING_CALL_AFFINITY"
                android:excludeFromRecents="true"
                android:noHistory="true"
                android:showOnLockScreen="true"
                android:turnScreenOn="true"
                android:configChanges="orientation"
                android:exported="true"
                android:theme="@style/CallkitIncomingTheme">
                <intent-filter>
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_INCOMING" />
                    <category android:name="android.intent.category.DEFAULT" />
                </intent-filter>
            </activity>
            <activity
                android:exported="false"
                android:theme="@style/TranslucentTheme"
                android:name="com.hiennv.flutter_callkit_incoming.TransparentActivity"/>

            <receiver
                android:name="com.hiennv.flutter_callkit_incoming.CallkitIncomingBroadcastReceiver"
                android:enabled="true"
                android:exported="true">
                <intent-filter>
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_INCOMING" />
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_ACCEPT" />
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_DECLINE" />
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_ENDED" />
                    <action android:name="${applicationId}.com.hiennv.flutter_callkit_incoming.ACTION_CALL_TIMEOUT" />
                </intent-filter>
            </receiver>

            <service
                android:enabled="true"
                android:exported="true"
                android:name="com.hiennv.flutter_callkit_incoming.CallkitSoundPlayerService"/>
        </config-file>

        <config-file target="config.xml" parent="/*">
            <preference name="AndroidXEnabled" value="true" />
            <preference name="GradlePluginKotlinEnabled" value="true" />
        </config-file>

        <framework src="cordova/android/build.gradle" custom="true" type="gradleReference"/>

        <source-file src="cordova/android/CordovaCallkitIncomingPlugin.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="cordova/android/AppUtils.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="cordova/android/CallkitIncomingBroadcastReceiver.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <!-- flutter callkit incoming kotlin -->
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/Call.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/CallkitConstants.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/CallkitIncomingActivity.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/CallkitNotificationManager.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/CallkitSoundPlayerService.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/SharedPreferencesUtils.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/TransparentActivity.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/Utils.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/widgets/CircleTransform.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming/widgets" />
        <source-file src="android/src/main/kotlin/com/hiennv/flutter_callkit_incoming/widgets/RippleRelativeLayout.kt" target-dir="src/main/kotlin/com/hiennv/flutter_callkit_incoming/widgets" />
        <!-- res/anim -->
        <resource-file src="android/src/main/res/anim/shake_anim.xml" target="res/anim/shake_anim.xml" />
        <!-- res/drawable -->
        <resource-file src="android/src/main/res/drawable/bg_button_accept.xml" target="res/drawable/bg_button_accept.xml" />
        <resource-file src="android/src/main/res/drawable/bg_button_decline.xml" target="res/drawable/bg_button_decline.xml" />
        <resource-file src="android/src/main/res/drawable/rounded_button_accept.xml" target="res/drawable/rounded_button_accept.xml" />
        <resource-file src="android/src/main/res/drawable/rounded_button_decline.xml" target="res/drawable/rounded_button_decline.xml" />
        <resource-file src="android/src/main/res/drawable/transparent.png" target="res/drawable/transparent.png" />
        <!-- res/drawable-hdpi -->
        <resource-file src="android/src/main/res/drawable-hdpi/ic_accept.png" target="res/drawable-hdpi/ic_accept.png" />
        <resource-file src="android/src/main/res/drawable-hdpi/ic_call_missed.png" target="res/drawable-hdpi/ic_call_missed.png" />
        <resource-file src="android/src/main/res/drawable-hdpi/ic_decline.png" target="res/drawable-hdpi/ic_decline.png" />
        <resource-file src="android/src/main/res/drawable-hdpi/ic_video_missed.png" target="res/drawable-hdpi/ic_video_missed.png" />
        <resource-file src="android/src/main/res/drawable-hdpi/ic_video.png" target="res/drawable-hdpi/ic_video.png" />
        <!-- res/drawable-mdpi -->
        <resource-file src="android/src/main/res/drawable-mdpi/ic_accept.png" target="res/drawable-mdpi/ic_accept.png" />
        <resource-file src="android/src/main/res/drawable-mdpi/ic_call_missed.png" target="res/drawable-mdpi/ic_call_missed.png" />
        <resource-file src="android/src/main/res/drawable-mdpi/ic_decline.png" target="res/drawable-mdpi/ic_decline.png" />
        <resource-file src="android/src/main/res/drawable-mdpi/ic_video_missed.png" target="res/drawable-mdpi/ic_video_missed.png" />
        <resource-file src="android/src/main/res/drawable-mdpi/ic_video.png" target="res/drawable-mdpi/ic_video.png" />
        <!-- res/drawable-v21 -->
        <resource-file src="android/src/main/res/drawable-v21/bg_button_accept.xml" target="res/drawable-v21/bg_button_accept.xml" />
        <resource-file src="android/src/main/res/drawable-v21/bg_button_decline.xml" target="res/drawable-v21/bg_button_decline.xml" />
        <resource-file src="android/src/main/res/drawable-v21/rounded_button_accept.xml" target="res/drawable-v21/rounded_button_accept.xml" />
        <resource-file src="android/src/main/res/drawable-v21/rounded_button_decline.xml" target="res/drawable-v21/rounded_button_decline.xml" />
        <!-- res/drawable-xhdpi -->
        <resource-file src="android/src/main/res/drawable-xhdpi/ic_accept.png" target="res/drawable-xhdpi/ic_accept.png" />
        <resource-file src="android/src/main/res/drawable-xhdpi/ic_call_missed.png" target="res/drawable-xhdpi/ic_call_missed.png" />
        <resource-file src="android/src/main/res/drawable-xhdpi/ic_decline.png" target="res/drawable-xhdpi/ic_decline.png" />
        <resource-file src="android/src/main/res/drawable-xhdpi/ic_video_missed.png" target="res/drawable-xhdpi/ic_video_missed.png" />
        <resource-file src="android/src/main/res/drawable-xhdpi/ic_video.png" target="res/drawable-xhdpi/ic_video.png" />
        <!-- res/drawable-xxhdpi -->
        <resource-file src="android/src/main/res/drawable-xxhdpi/ic_accept.png" target="res/drawable-xxhdpi/ic_accept.png" />
        <resource-file src="android/src/main/res/drawable-xxhdpi/ic_call_missed.png" target="res/drawable-xxhdpi/ic_call_missed.png" />
        <resource-file src="android/src/main/res/drawable-xxhdpi/ic_decline.png" target="res/drawable-xxhdpi/ic_decline.png" />
        <resource-file src="android/src/main/res/drawable-xxhdpi/ic_video_missed.png" target="res/drawable-xxhdpi/ic_video_missed.png" />
        <resource-file src="android/src/main/res/drawable-xxhdpi/ic_video.png" target="res/drawable-xxhdpi/ic_video.png" />
        <!-- res/drawable-xxxhdpi -->
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_accept.png" target="res/drawable-xxxhdpi/ic_accept.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_call_missed.png" target="res/drawable-xxxhdpi/ic_call_missed.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_decline.png" target="res/drawable-xxxhdpi/ic_decline.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_video_missed.png" target="res/drawable-xxxhdpi/ic_video_missed.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_video.png" target="res/drawable-xxxhdpi/ic_video.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_default_avatar.png" target="res/drawable-xxxhdpi/ic_default_avatar.png" />
        <resource-file src="android/src/main/res/drawable-xxxhdpi/ic_logo.png" target="res/drawable-xxxhdpi/ic_logo.png" />
        <!-- res/layout -->
        <resource-file src="android/src/main/res/layout/activity_callkit_incoming.xml" target="res/layout/activity_callkit_incoming.xml" />
        <resource-file src="android/src/main/res/layout/layout_custom_miss_notification.xml" target="res/layout/layout_custom_miss_notification.xml" />
        <resource-file src="android/src/main/res/layout/layout_custom_notification.xml" target="res/layout/layout_custom_notification.xml" />
        <resource-file src="android/src/main/res/layout/layout_custom_small_ex_notification.xml" target="res/layout/layout_custom_small_ex_notification.xml" />
        <resource-file src="android/src/main/res/layout/layout_custom_small_notification.xml" target="res/layout/layout_custom_small_notification.xml" />
        <!-- res/layout-w600dp-land -->
        <resource-file src="android/src/main/res/layout-w600dp-land/activity_callkit_incoming.xml" target="res/layout-w600dp-land/activity_callkit_incoming.xml" />
        <!-- res/raw -->
        <resource-file src="android/src/main/res/raw/ringtone_default.mp3" target="res/raw/ringtone_default.mp3" />
        <!-- res/values -->
        <resource-file src="android/src/main/res/values/attrs.xml" target="res/values/attrs.xml" />
        <!-- <resource-file src="android/src/main/res/values/colors.xml" target="res/values/colors.xml" /> -->
        <resource-file src="android/src/main/res/values/dimens.xml" target="res/values/dimens.xml" />
        <!-- <resource-file src="android/src/main/res/values/strings.xml" target="res/values/strings.xml" /> -->
        <resource-file src="android/src/main/res/values/styles.xml" target="res/values/styles.xml" />

        <config-file parent="/resources" target="res/values/colors.xml">
            <color name="accept">#4CAF50</color>
            <color name="accept_ripple">#A6FFA9</color>
            <color name="decline">#F44336</color>
            <color name="decline_ripple">#FB8D85</color>
            <color name="action_text">#FFFFFF</color>
            <color name="ripple_main_color">#80ffffff</color>
        </config-file>

        <config-file parent="/resources" target="res/values/strings.xml">
            <string name="text_accept">Accept</string>
            <string name="text_decline">Decline</string>
            <string name="text_missed_call">Missed call</string>
            <string name="text_call_back">Call back</string>
            <string name="text_post_notification_message_required">Notification permission is required, Please allow notification permission from setting.</string>
        </config-file>

        <hook type="before_plugin_install" src="cordova/hooks/importRForKotlin.js" />
        <hook type="after_plugin_install" src="cordova/hooks/disableKotlinAndroidExtensions.js" />
        <hook type="before_plugin_uninstall" src="cordova/hooks/enableKotlinAndroidExtensions.js" />
    </platform>

    <platform name="ios">
        <config-file target="config.xml" parent="/*">
            <feature name="CordovaCallkitIncomingPlugin">
                <param name="ios-package" value="CordovaCallkitIncomingPlugin"/>
                <param name="onload" value="true" />
            </feature>

            <preference name="SwiftVersion" value="4.2" />
            <preference name="UseSwiftLanguageVersion" value="4.2" />
        </config-file>

        <config-file target="*-Info.plist" parent="UIBackgroundModes">
            <array>
                <string>voip</string>
                <string>remote-notification</string>
            </array>
        </config-file>

        <source-file src="cordova/ios/CordovaCallkitIncomingPlugin.swift" />

        <source-file src="ios/Classes/Call.swift" />
        <source-file src="ios/Classes/CallManager.swift" />
        <source-file src="ios/Classes/NSUserActivity.swift" />
        <source-file src="ios/Classes/StringUtils.swift" />
        <source-file src="ios/Classes/WeakArray.swift" />

        <podspec>
            <config>
                <source url="https://cdn.cocoapods.org/"/>
            </config>
            <pods use-frameworks="true">
                <pod name="CryptoSwift" spec="1.8.0" />
            </pods>
        </podspec>

        <dependency id="cordova-plugin-add-swift-support" version="2.0.2"/>
        <hook type="before_plugin_install" src="cordova/hooks/renameIOSData.js" />
    </platform>
</plugin>
